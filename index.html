<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Todo Calendrier</title>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  color:white;
  background:url("https://i.imgur.com/8Km9tLL.jpg") no-repeat center/cover fixed;
}

.page{ display:none; padding:20px; }

header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:22px;
  margin-bottom:20px;
}

#todoList{
  display:flex;
  flex-direction:column;
  gap:10px;
}

.todo{
  display:flex;
  align-items:center;
  justify-content:space-between;
  background:rgba(0,0,0,0.5);
  padding:10px;
  border-radius:10px;
}

.todo span{
  flex:1;
  margin-left:10px;
}

.right-buttons button{
  margin-left:5px;
}

footer{
  position:fixed;
  bottom:15px;
  left:50%;
  transform:translateX(-50%);
}

footer button{
  padding:10px 25px;
  margin:5px;
  border:none;
  border-radius:20px;
  font-size:16px;
}

#monthGrid{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:8px;
}

.dayBtn{
  padding:10px;
  border:none;
  border-radius:10px;
  background:rgba(0,0,0,0.5);
  color:white;
}

.today{
  border:2px solid yellow;
}

.dragging{
  opacity:0.4;
}
</style>
</head>
<body>

<!-- PAGE DAY -->
<div id="dayPage" class="page">
  <header>
    <div id="dayTitle"></div>
    <button onclick="showInput()">âž•</button>
  </header>

  <input id="taskInput" placeholder="Nouvelle tÃ¢che..." style="display:none;width:100%;padding:10px;border-radius:10px;border:none;margin-bottom:15px;">

  <div id="todoList"></div>
</div>

<!-- PAGE MONTH -->
<div id="monthPage" class="page">
  <header>
    <div id="monthTitle"></div>
  </header>
  <div id="monthGrid"></div>
</div>

<footer>
  <button onclick="goToToday()">Day</button>
  <button onclick="showPage('monthPage')">Month</button>
</footer>

<script>
const dayPage=document.getElementById("dayPage");
const monthPage=document.getElementById("monthPage");
const dayTitle=document.getElementById("dayTitle");
const monthTitle=document.getElementById("monthTitle");
const monthGrid=document.getElementById("monthGrid");
const todoList=document.getElementById("todoList");
const taskInput=document.getElementById("taskInput");

let selectedDate=new Date();

const jours=["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"];
const mois=["janvier","fÃ©vrier","mars","avril","mai","juin","juillet","aoÃ»t","septembre","octobre","novembre","dÃ©cembre"];

function formatKey(date){
  return date.getFullYear()+"-"+(date.getMonth()+1)+"-"+date.getDate();
}

function getTasks(){
  return JSON.parse(localStorage.getItem(formatKey(selectedDate))||"[]");
}

function saveTasks(tasks){
  localStorage.setItem(formatKey(selectedDate),JSON.stringify(tasks));
}

function updateDayView(){
  const d=selectedDate;
  dayTitle.textContent=
    jours[d.getDay()]+" "+d.getDate()+" "+mois[d.getMonth()];
  displayTasks();
}

function displayTasks(){
  todoList.innerHTML="";
  const tasks=getTasks();

  tasks.forEach((task,index)=>{
    const div=document.createElement("div");
    div.className="todo";
    div.draggable=true;

    let pressTimer;

    // appui long 3 sec pour activer dÃ©placement
    div.addEventListener("touchstart",()=>{
      pressTimer=setTimeout(()=>{
        div.classList.add("dragging");
      },3000);
    });

    div.addEventListener("touchend",()=>{
      clearTimeout(pressTimer);
      div.classList.remove("dragging");
    });

    div.addEventListener("dragstart",()=>div.classList.add("dragging"));
    div.addEventListener("dragend",()=>{
      div.classList.remove("dragging");
      saveNewOrder();
    });

    const check=document.createElement("input");
    check.type="checkbox";
    check.checked=task.done;
    check.onchange=()=>{
      task.done=check.checked;
      saveTasks(tasks);
    };

    const text=document.createElement("span");
    text.textContent=task.text;

    const right=document.createElement("div");
    right.className="right-buttons";

    const edit=document.createElement("button");
    edit.textContent="âœï¸";
    edit.onclick=()=>{
      taskInput.style.display="block";
      taskInput.value=task.text;
      deleteTask(index);
    };

    const del=document.createElement("button");
    del.textContent="ðŸ—‘ï¸";
    del.onclick=()=>deleteTask(index);

    right.appendChild(edit);
    right.appendChild(del);

    div.appendChild(check);
    div.appendChild(text);
    div.appendChild(right);

    todoList.appendChild(div);
  });
}

function saveNewOrder(){
  const newTasks=[];
  document.querySelectorAll(".todo").forEach(todo=>{
    const text=todo.querySelector("span").textContent;
    const done=todo.querySelector("input").checked;
    newTasks.push({text,done});
  });
  saveTasks(newTasks);
}

function deleteTask(index){
  const tasks=getTasks();
  tasks.splice(index,1);
  saveTasks(tasks);
  displayTasks();
}

taskInput.addEventListener("keypress",e=>{
  if(e.key==="Enter" && taskInput.value.trim()!=""){
    const tasks=getTasks();
    tasks.push({text:taskInput.value,done:false});
    saveTasks(tasks);
    taskInput.value="";
    taskInput.style.display="none";
    displayTasks();
  }
});

function showInput(){
  taskInput.style.display="block";
  taskInput.focus();
}

function showPage(page){
  dayPage.style.display="none";
  monthPage.style.display="none";
  document.getElementById(page).style.display="block";
  if(page==="monthPage") generateMonth();
}

function goToToday(){
  selectedDate=new Date();
  updateDayView();
  showPage("dayPage");
}

function generateMonth(){
  const now=new Date();
  monthTitle.textContent=mois[now.getMonth()]+" "+now.getFullYear();
  monthGrid.innerHTML="";

  const days=new Date(now.getFullYear(),now.getMonth()+1,0).getDate();

  for(let i=1;i<=days;i++){
    const btn=document.createElement("button");
    btn.textContent=i;
    btn.className="dayBtn";

    if(i===new Date().getDate()) btn.classList.add("today");

    btn.onclick=()=>{
      selectedDate=new Date(now.getFullYear(),now.getMonth(),i);
      updateDayView();
      showPage("dayPage");
    };

    monthGrid.appendChild(btn);
  }
}

// dÃ©marrage
goToToday();
</script>
</body>
</html>
