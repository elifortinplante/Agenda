<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Organisation</title>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  color:white;
  background:url("https://i.pinimg.com/originals/2c/4e/9f/2c4e9f6b1c5d2b7a3e59d5e9bfbaf0f3.jpg") no-repeat center center fixed;
  background-size:cover;
}

header{
  text-align:center;
  padding:15px;
  background:rgba(0,0,0,0.4);
}

nav{
  display:flex;
  justify-content:center;
  gap:20px;
  margin-top:10px;
}

button{
  padding:10px 15px;
  border:none;
  border-radius:10px;
  cursor:pointer;
}

.container{
  padding:20px;
}

input{
  padding:10px;
  width:70%;
  border-radius:10px;
  border:none;
}

.addBtn{
  padding:10px;
  border-radius:10px;
}

.task{
  display:flex;
  align-items:center;
  background:rgba(0,0,0,0.5);
  padding:10px;
  margin-top:10px;
  border-radius:12px;
}

.task span{
  flex:1;
  margin-left:10px;
}

.icons{
  display:flex;
  gap:10px;
  margin-left:10px;
}

.completed{
  text-decoration:line-through;
  opacity:0.6;
}

.calendar{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:5px;
  margin-top:15px;
}

.dayBox{
  background:rgba(0,0,0,0.4);
  padding:15px;
  text-align:center;
  border-radius:8px;
  cursor:pointer;
}
</style>
</head>
<body>

<header>
  <h2 id="dateTitle"></h2>
  <nav>
    <button onclick="showDay()">Day</button>
    <button onclick="showMonth()">Month</button>
  </nav>
</header>

<div class="container" id="dayView">
  <input id="taskInput" placeholder="Nouvelle tÃ¢che">
  <button class="addBtn" onclick="addTask()">Ajouter</button>
  <div id="taskList"></div>
</div>

<div class="container" id="monthView" style="display:none;">
  <div class="calendar" id="calendar"></div>
</div>

<script>
let today = new Date();
let selectedDate = new Date(today);
let dragItem = null;
let holdTimer;

function formatDate(date){
  return date.toLocaleDateString('fr-CA',{
    weekday:'long',
    year:'numeric',
    month:'long',
    day:'numeric'
  });
}

function updateTitle(){
  document.getElementById("dateTitle").innerText = formatDate(selectedDate);
}

function getKey(){
  return selectedDate.toISOString().split("T")[0];
}

function saveTasks(tasks){
  localStorage.setItem("tasks-"+getKey(), JSON.stringify(tasks));
}

function loadTasks(){
  return JSON.parse(localStorage.getItem("tasks-"+getKey())) || [];
}

function renderTasks(){
  const list = document.getElementById("taskList");
  list.innerHTML="";
  const tasks = loadTasks();

  tasks.forEach((task,index)=>{
    const div = document.createElement("div");
    div.className="task";
    div.draggable=false;

    const checkbox=document.createElement("input");
    checkbox.type="checkbox";
    checkbox.checked=task.done;
    checkbox.onchange=()=>{
      task.done=checkbox.checked;
      saveTasks(tasks);
      renderTasks();
    };

    const span=document.createElement("span");
    span.innerText=task.text;
    if(task.done) span.classList.add("completed");

    // appui 3 sec pour dÃ©placer
    span.onmousedown=()=>{
      holdTimer=setTimeout(()=>{
        div.draggable=true;
        div.style.opacity="0.5";
      },3000);
    };

    span.onmouseup=()=> clearTimeout(holdTimer);
    span.onmouseleave=()=> clearTimeout(holdTimer);

    div.ondragstart=()=> dragItem=index;

    div.ondragover=(e)=> e.preventDefault();

    div.ondrop=()=>{
      const moved=tasks.splice(dragItem,1)[0];
      tasks.splice(index,0,moved);
      saveTasks(tasks);
      renderTasks();
    };

    const icons=document.createElement("div");
    icons.className="icons";

    const edit=document.createElement("button");
    edit.innerText="âœï¸";
    edit.onclick=()=>{
      const newText=prompt("Modifier:",task.text);
      if(newText){
        task.text=newText;
        saveTasks(tasks);
        renderTasks();
      }
    };

    const del=document.createElement("button");
    del.innerText="ðŸ—‘ï¸";
    del.onclick=()=>{
      tasks.splice(index,1);
      saveTasks(tasks);
      renderTasks();
    };

    icons.appendChild(edit);
    icons.appendChild(del);

    div.appendChild(checkbox);
    div.appendChild(span);
    div.appendChild(icons);
    list.appendChild(div);
  });
}

function addTask(){
  const input=document.getElementById("taskInput");
  if(input.value.trim()==="") return;

  const tasks=loadTasks();
  tasks.push({text:input.value, done:false});
  saveTasks(tasks);
  input.value="";
  renderTasks();
}

function showDay(){
  selectedDate=new Date(today);
  updateTitle();
  renderTasks();
  document.getElementById("dayView").style.display="block";
  document.getElementById("monthView").style.display="none";
}

function showMonth(){
  document.getElementById("dayView").style.display="none";
  document.getElementById("monthView").style.display="block";
  renderCalendar();
}

function renderCalendar(){
  const cal=document.getElementById("calendar");
  cal.innerHTML="";

  const year=today.getFullYear();
  const month=today.getMonth();
  const days=new Date(year,month+1,0).getDate();

  for(let i=1;i<=days;i++){
    const box=document.createElement("div");
    box.className="dayBox";
    box.innerText=i;

    box.onclick=()=>{
      selectedDate=new Date(year,month,i);
      updateTitle();
      renderTasks();
      showDay();
    };

    cal.appendChild(box);
  }
}

updateTitle();
renderTasks();
</script>
</body>
</html>
